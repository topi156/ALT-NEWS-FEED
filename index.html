<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALT Intel â€“ Private Markets Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,400&family=JetBrains+Mono:wght@300;400;500;700&family=Crimson+Pro:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f5f2eb;
  --bg2: #ede9df;
  --surface: #ffffff;
  --ink: #1a1612;
  --ink-mid: #4a4540;
  --ink-dim: #8a8278;
  --rule: #d8d2c4;
  --accent: #c4381a;
  --accent2: #1a4a8a;
  --gold: #b8860b;
  --pe-c: #c4381a;
  --credit-c: #1a4a8a;
  --infra-c: #2a6a3a;
  --re-c: #7a3a1a;
  --hedge-c: #4a1a7a;
  --macro-c: #1a5a6a;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'Crimson Pro', Georgia, serif;
  min-height: 100vh;
  font-size: 16px;
}

/* Paper texture */
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image:
    repeating-linear-gradient(0deg, transparent, transparent 28px, rgba(0,0,0,0.015) 28px, rgba(0,0,0,0.015) 29px);
  pointer-events: none;
  z-index: 0;
}

/* â”€â”€ MASTHEAD â”€â”€ */
.masthead {
  border-bottom: 3px double var(--ink);
  padding: 0 48px;
  background: var(--bg);
  position: sticky;
  top: 0;
  z-index: 200;
}

.masthead-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 0 12px;
  border-bottom: 1px solid var(--ink);
}

.pub-name {
  font-family: 'Playfair Display', Georgia, serif;
  font-size: 36px;
  font-weight: 900;
  letter-spacing: -0.02em;
  line-height: 1;
  color: var(--ink);
}

.pub-name em {
  color: var(--accent);
  font-style: normal;
}

.masthead-meta {
  text-align: center;
}

.masthead-meta .edition {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--ink-dim);
  display: block;
  margin-bottom: 4px;
}

.masthead-meta .date-line {
  font-family: 'Crimson Pro', serif;
  font-size: 13px;
  font-style: italic;
  color: var(--ink-mid);
}

.masthead-actions {
  display: flex;
  gap: 10px;
  align-items: center;
}

.btn-primary {
  background: var(--ink);
  color: var(--bg);
  border: none;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  padding: 9px 18px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-primary:hover { background: var(--accent); }
.btn-primary:disabled { opacity:0.4; pointer-events:none; }

.btn-secondary {
  background: transparent;
  color: var(--ink);
  border: 1px solid var(--rule);
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: 8px 16px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-secondary:hover { border-color: var(--ink); }

/* Filter nav */
.masthead-nav {
  display: flex;
  align-items: center;
  gap: 0;
  padding: 10px 0;
  overflow-x: auto;
}

.nav-item {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: 5px 18px;
  border: none;
  background: transparent;
  color: var(--ink-dim);
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
  border-right: 1px solid var(--rule);
  position: relative;
}

.nav-item:first-child { padding-left: 0; }
.nav-item:last-child { border-right: none; }

.nav-item:hover { color: var(--ink); }
.nav-item.active { color: var(--ink); font-weight: 700; }

.nav-item.active::after {
  content: '';
  position: absolute;
  bottom: -10px;
  left: 0; right: 0;
  height: 3px;
  background: var(--accent);
}

/* Ticker */
.ticker {
  background: var(--ink);
  color: var(--bg);
  padding: 0;
  height: 28px;
  display: flex;
  align-items: center;
  overflow: hidden;
}

.ticker-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  background: var(--accent);
  color: white;
  padding: 0 14px;
  height: 100%;
  display: flex;
  align-items: center;
  flex-shrink: 0;
  white-space: nowrap;
}

.ticker-track { overflow: hidden; flex: 1; }
.ticker-inner {
  display: flex;
  animation: ticker-scroll 60s linear infinite;
  white-space: nowrap;
}

.ticker-item {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  letter-spacing: 0.04em;
  padding: 0 40px;
  color: rgba(245,242,235,0.75);
}

.ticker-item strong { color: var(--bg); font-weight: 500; margin-right: 5px; color: var(--accent); }

@keyframes ticker-scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

/* â”€â”€ LAYOUT â”€â”€ */
.page {
  position: relative; z-index: 1;
  max-width: 1440px;
  margin: 0 auto;
  padding: 0 48px 60px;
  display: grid;
  grid-template-columns: 1fr 300px;
  grid-template-rows: auto 1fr;
  gap: 0 40px;
}

/* â”€â”€ HERO STORY â”€â”€ */
.hero-strip {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 0;
  border-bottom: 2px solid var(--ink);
  margin-bottom: 32px;
  padding: 28px 0;
}

.hero-story {
  padding: 0 28px;
  border-right: 1px solid var(--rule);
  cursor: pointer;
  transition: all 0.2s;
}

.hero-story:first-child { padding-left: 0; }
.hero-story:last-child { border-right: none; }
.hero-story:hover { opacity: 0.8; }

.hero-kicker {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.18em;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.hero-headline {
  font-family: 'Playfair Display', serif;
  font-size: 20px;
  font-weight: 700;
  line-height: 1.3;
  margin-bottom: 10px;
  color: var(--ink);
}

.hero-deck {
  font-family: 'Crimson Pro', serif;
  font-size: 14px;
  color: var(--ink-mid);
  line-height: 1.6;
  font-weight: 300;
}

/* â”€â”€ MAIN FEED â”€â”€ */
.feed-section { padding-top: 0; }

.section-rule {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
}

.section-rule h2 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--ink-dim);
  white-space: nowrap;
}

.rule-line {
  flex: 1;
  height: 1px;
  background: var(--rule);
}

.article {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 16px;
  padding: 20px 0;
  border-bottom: 1px solid var(--rule);
  cursor: pointer;
  transition: opacity 0.15s;
  animation: slideIn 0.3s ease forwards;
  opacity: 0;
}

@keyframes slideIn {
  from { opacity:0; transform: translateY(8px); }
  to { opacity:1; transform: translateY(0); }
}

.article:hover { opacity: 0.75; }
.article:hover .article-headline { text-decoration: underline; text-underline-offset: 3px; }
.article:last-child { border-bottom: none; }

.article-left {}

.article-kicker {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 7px;
}

.sector-pill {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.14em;
  padding: 2px 8px;
  border-left: 3px solid currentColor;
  background: transparent;
}

.sector-pill.PE { color: var(--pe-c); background: rgba(196,56,26,0.06); }
.sector-pill.Credit { color: var(--credit-c); background: rgba(26,74,138,0.06); }
.sector-pill.Infra { color: var(--infra-c); background: rgba(42,106,58,0.06); }
.sector-pill.RE { color: var(--re-c); background: rgba(122,58,26,0.06); }
.sector-pill.Hedge { color: var(--hedge-c); background: rgba(74,26,122,0.06); }
.sector-pill.Macro { color: var(--macro-c); background: rgba(26,90,106,0.06); }

.article-source {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--ink-dim);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.article-time {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--ink-dim);
}

.article-headline {
  font-family: 'Playfair Display', serif;
  font-size: 17px;
  font-weight: 700;
  line-height: 1.35;
  margin-bottom: 8px;
  color: var(--ink);
}

.article-body {
  font-family: 'Crimson Pro', serif;
  font-size: 15px;
  color: var(--ink-mid);
  line-height: 1.65;
  font-weight: 300;
  margin-bottom: 10px;
}

/* AI Summary */
.ai-summary-wrap {
  margin-top: 10px;
  padding: 12px 14px;
  background: rgba(26,74,138,0.04);
  border-left: 3px solid var(--accent2);
}

.ai-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.15em;
  color: var(--accent2);
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.ai-text {
  font-family: 'Crimson Pro', serif;
  font-size: 14px;
  color: var(--ink-mid);
  line-height: 1.65;
  font-weight: 300;
  font-style: italic;
}

.article-actions {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-top: 6px;
}

.action-btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  background: transparent;
  border: 1px solid var(--rule);
  color: var(--ink-mid);
  padding: 5px 12px;
  cursor: pointer;
  transition: all 0.15s;
  display: flex; align-items: center; gap: 6px;
}

.action-btn:hover { border-color: var(--ink-mid); color: var(--ink); }
.action-btn.summarized { border-color: var(--accent2); color: var(--accent2); }
.action-btn:disabled { opacity: 0.35; pointer-events: none; }

.read-more {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--ink-dim);
  text-decoration: none;
  transition: color 0.15s;
  margin-right: auto;
}
.read-more:hover { color: var(--accent); }

.paywall-badge {
  font-family: 'JetBrains Mono', monospace;
  font-size: 8px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--ink-dim);
  border: 1px solid var(--rule);
  padding: 2px 6px;
  opacity: 0.6;
}

/* Relevance */
.rel-score {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--ink-dim);
  display: flex;
  align-items: center;
  gap: 6px;
}

.rel-dots {
  display: flex; gap: 2px;
}

.rel-dot {
  width: 5px; height: 5px; border-radius: 50%;
  background: var(--rule);
}
.rel-dot.filled { background: var(--gold); }

/* Article right col */
.article-right {
  width: 80px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  padding-top: 4px;
  flex-shrink: 0;
}

.big-number {
  font-family: 'Playfair Display', serif;
  font-size: 42px;
  font-weight: 900;
  line-height: 1;
  color: var(--bg2);
  letter-spacing: -0.03em;
  user-select: none;
}

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar {
  border-left: 1px solid var(--rule);
  padding-left: 28px;
  padding-top: 0;
}

.sidebar-widget {
  margin-bottom: 32px;
  padding-bottom: 28px;
  border-bottom: 1px solid var(--rule);
}

.sidebar-widget:last-child { border-bottom: none; }

.widget-head {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--ink-dim);
  margin-bottom: 16px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--ink);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* Daily Briefing widget */
.briefing-widget {
  background: var(--ink);
  color: var(--bg);
  padding: 18px;
  margin-bottom: 28px;
}

.briefing-head {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: rgba(245,242,235,0.5);
  margin-bottom: 12px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(245,242,235,0.15);
  display: flex; align-items: center; gap: 8px;
}

.briefing-head::before {
  content: 'â˜…';
  color: var(--gold);
  font-size: 10px;
}

.briefing-body {
  font-family: 'Crimson Pro', serif;
  font-size: 14px;
  line-height: 1.7;
  color: rgba(245,242,235,0.75);
  font-weight: 300;
  min-height: 80px;
}

.briefing-body p { margin-bottom: 10px; }
.briefing-body p:last-child { margin-bottom: 0; }

.briefing-placeholder {
  font-style: italic;
  color: rgba(245,242,235,0.35);
  font-size: 13px;
}

.briefing-actions {
  display: flex;
  gap: 8px;
  margin-top: 14px;
  padding-top: 12px;
  border-top: 1px solid rgba(245,242,235,0.15);
}

.btn-briefing {
  flex: 1;
  background: var(--accent);
  color: white;
  border: none;
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  padding: 9px 10px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}

.btn-briefing:hover { background: #a02e14; }
.btn-briefing:disabled { opacity:0.4; pointer-events:none; }

.btn-email {
  flex: 1;
  background: transparent;
  color: rgba(245,242,235,0.6);
  border: 1px solid rgba(245,242,235,0.2);
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  padding: 9px 10px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}

.btn-email:hover { border-color: rgba(245,242,235,0.5); color: rgba(245,242,235,0.85); }
.btn-email:disabled { opacity: 0.4; pointer-events: none; }

/* Sector stats */
.sector-stat {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  font-size: 13px;
}

.stat-name {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  width: 54px;
  flex-shrink: 0;
}

.stat-bar {
  flex: 1; height: 3px;
  background: var(--bg2);
}

.stat-fill {
  height: 100%;
  transition: width 0.6s ease;
}

.stat-n {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--ink-dim);
  width: 18px;
  text-align: right;
}

/* Sources */
.source-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid var(--rule);
}

.source-row:last-child { border-bottom: none; }

.source-n { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--ink); }
.source-label { font-family: 'JetBrains Mono', monospace; font-size: 9px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--ink-mid); }
.source-status-dot { width: 6px; height: 6px; border-radius: 50%; }
.source-status-dot.on { background: var(--infra-c); }
.source-status-dot.off { background: var(--rule); }

/* Email modal */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(26,22,18,0.75);
  z-index: 1000;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none;
  transition: opacity 0.2s;
}

.modal-overlay.open { opacity:1; pointer-events:all; }

.modal {
  background: var(--surface);
  border: 1px solid var(--rule);
  padding: 40px 48px;
  max-width: 620px;
  width: 90%;
  transform: translateY(20px);
  transition: transform 0.3s ease;
}

.modal-overlay.open .modal { transform: translateY(0); }

.modal-kicker {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--ink-dim);
  margin-bottom: 8px;
}

.modal-title {
  font-family: 'Playfair Display', serif;
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 16px;
  line-height: 1.2;
}

.modal-title em { color: var(--accent); font-style: normal; }

.modal-divider { height: 1px; background: var(--rule); margin: 20px 0; }

.email-preview {
  background: var(--bg);
  border: 1px solid var(--rule);
  padding: 24px 28px;
  margin-bottom: 20px;
}

.email-from {
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  color: var(--ink-dim);
  margin-bottom: 4px;
}

.email-subject {
  font-family: 'Playfair Display', serif;
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--rule);
}

.email-body-preview {
  font-family: 'Crimson Pro', serif;
  font-size: 14px;
  color: var(--ink-mid);
  line-height: 1.7;
  font-weight: 300;
}

.modal-form {
  display: flex;
  gap: 10px;
  margin-bottom: 12px;
}

.modal-input {
  flex: 1;
  border: 1px solid var(--rule);
  background: var(--bg);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  padding: 10px 14px;
  color: var(--ink);
  outline: none;
  transition: border-color 0.2s;
}

.modal-input:focus { border-color: var(--ink); }

.modal-time {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  color: var(--ink-dim);
  margin-top: 6px;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.modal-close {
  position: absolute;
  top: 16px; right: 20px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 10px;
  background: none; border: none;
  cursor: pointer;
  color: var(--ink-dim);
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.modal { position: relative; }

.success-msg {
  display: none;
  text-align: center;
  padding: 20px;
}

.success-msg.show { display: block; }

.success-msg h3 {
  font-family: 'Playfair Display', serif;
  font-size: 22px;
  margin-bottom: 8px;
}

.success-msg p {
  font-family: 'Crimson Pro', serif;
  color: var(--ink-mid);
  font-size: 15px;
}

/* Spinning icon */
.spin { animation: spin 1.2s linear infinite; display:inline-block; }
@keyframes spin { to { transform: rotate(360deg); } }

::-webkit-scrollbar { height: 3px; width: 3px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--rule); }

@media (max-width: 960px) {
  .page { grid-template-columns: 1fr; padding: 0 20px 40px; }
  .sidebar { border-left: none; border-top: 2px solid var(--ink); padding-left: 0; padding-top: 28px; }
  .hero-strip { grid-template-columns: 1fr; gap: 20px; }
  .hero-story { border-right: none; border-bottom: 1px solid var(--rule); padding: 0 0 20px; }
  .masthead { padding: 0 20px; }
}

.article-why {
  font-size: 12px;
  color: var(--ink-dim);
  margin: 4px 0 8px;
  line-height: 1.5;
  padding: 5px 10px;
  border-left: 2px solid var(--accent);
  background: rgba(196,56,26,0.03);
}
.why-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 9px;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--accent);
  font-weight: 700;
  margin-right: 6px;
}
</style>
</head>
<body>

<header class="masthead">
  <div class="masthead-top">
    <div class="pub-name">ALT<em>Â·</em>INTEL</div>
    <div class="masthead-meta">
      <span class="edition">Private Markets Intelligence</span>
      <span class="date-line" id="current-date">Loading...</span>
    </div>
    <div class="masthead-actions">
      <button class="btn-secondary" onclick="loadFeed()">
        <svg id="refresh-ico" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 12a9 9 0 11-6.219-8.56"/></svg>
        Refresh
      </button>
      <button class="btn-primary" onclick="openEmailModal()">
        âœ‰ Subscribe Daily
      </button>
    </div>
  </div>
  <nav class="masthead-nav">
    <button class="nav-item active" data-s="all" onclick="filter('all',this)">All Sectors</button>
    <button class="nav-item" data-s="PE" onclick="filter('PE',this)">Private Equity</button>
    <button class="nav-item" data-s="Credit" onclick="filter('Credit',this)">Private Credit</button>
    <button class="nav-item" data-s="Infra" onclick="filter('Infra',this)">Infrastructure</button>
    <button class="nav-item" data-s="RE" onclick="filter('RE',this)">Real Estate</button>
    <button class="nav-item" data-s="Hedge" onclick="filter('Hedge',this)">Hedge Funds</button>
    <button class="nav-item" data-s="Macro" onclick="filter('Macro',this)">Macro</button>
  </nav>
</header>

<div class="ticker">
  <div class="ticker-label">BREAKING</div>
  <div class="ticker-track">
    <div class="ticker-inner" id="ticker-inner">
      <span class="ticker-item">Loading live intel...</span>
    </div>
  </div>
</div>

<div class="page">

  <div class="hero-strip" id="hero-strip">
    </div>

  <div class="feed-section">
    <div class="section-rule">
      <h2>Latest Intelligence</h2>
      <div class="rule-line"></div>
      <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--ink-dim);white-space:nowrap;" id="feed-count">â€” 0 articles</span>
    </div>
    <div id="feed-container"></div>
  </div>

  <aside class="sidebar">

    <div class="briefing-widget">
      <div class="briefing-head">Morning Briefing â€” AI Generated</div>
      <div class="briefing-body" id="briefing-body">
        <span class="briefing-placeholder">AI features require a server-side proxy (API key cannot run in the browser). News feed works normally.</span>
      </div>
      <div class="briefing-actions">
        <button class="btn-briefing" id="gen-btn" onclick="generateBriefing()">âš¡ Generate</button>
        <button class="btn-email" id="email-brief-btn" onclick="openEmailModal()" disabled>âœ‰ Email</button>
      </div>
    </div>

    <div class="sidebar-widget">
      <div class="widget-head">
        <span>Sector Distribution</span>
        <span id="total-articles" style="color:var(--ink)">0</span>
      </div>
      <div id="sector-stats"></div>
    </div>

    <div class="sidebar-widget">
      <div class="widget-head">Data Sources</div>
      <div id="sources-widget"></div>
    </div>

  </aside>
</div>

<div class="modal-overlay" id="email-modal" onclick="closeModalOutside(event)">
  <div class="modal">
    <button class="modal-close" onclick="closeEmailModal()">âœ• Close</button>
    <div class="modal-kicker">Daily Briefing Delivery</div>
    <div class="modal-title">Subscribe to <em>ALTÂ·Intel</em></div>
    <p style="font-family:'Crimson Pro',serif;font-size:15px;color:var(--ink-mid);line-height:1.65;margin-bottom:16px;">Receive a personalized AI-generated briefing on private markets news every morning at 7:00 AM.</p>
    <div class="modal-divider"></div>

    <div id="email-preview-section">
      <div class="email-preview">
        <div class="email-from">From: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="90f2e2f9f5f6f9fef7d0f1fce4bdf9fee4f5fcbef3fffd">[email&#160;protected]</a> Â· To: you</div>
        <div class="email-subject" id="email-subject-preview">ALTÂ·Intel Morning Briefing</div>
        <div class="email-body-preview" id="email-body-preview">
          <em style="color:var(--ink-dim);font-size:13px;">Generate a briefing first to preview your email content...</em>
        </div>
      </div>

      <div class="modal-form">
        <input class="modal-input" type="email" id="email-input" placeholder="your@email.com" />
        <button class="btn-primary" id="subscribe-btn" onclick="subscribe()">Subscribe</button>
      </div>
      <div class="modal-time">ðŸ“… Delivered daily at 07:00 AM Â· Unsubscribe anytime</div>
    </div>

    <div class="success-msg" id="success-msg">
      <h3>You're subscribed.</h3>
      <p>Your first briefing will arrive tomorrow morning at 7:00 AM.</p>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// RSS FEEDS â€” HYBRID APPROACH (Open + Premium)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RSS_FEEDS = [
  // â”€â”€ Open / Free Sources (Get +15 Score Bonus) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { url: "https://pitchbook.com/blog/rss.xml",                       source: "PitchBook (Open)",sector: "PE",    paywall: false },
  { url: "https://altassets.net/feed",                               source: "AltAssets",       sector: "PE",    paywall: false },
  { url: "https://techcrunch.com/category/venture/feed/",            source: "TechCrunch VC",   sector: "PE",    paywall: false },
  { url: "https://renewablesnow.com/news/rss/",                      source: "Renewables Now",  sector: "Infra", paywall: false },
  { url: "https://www.rechargenews.com/rss",                         source: "Recharge News",   sector: "Infra", paywall: false },
  { url: "https://therealdeal.com/feed/",                            source: "The Real Deal",   sector: "RE",    paywall: false },
  { url: "https://www.commercialobserver.com/feed/",                 source: "Commercial Observer", sector: "RE", paywall: false },
  { url: "https://opalesque.com/rss.xml",                            source: "Opalesque",       sector: "Hedge", paywall: false },
  { url: "https://news.google.com/rss/search?q=%22private+equity%22+OR+%22private+credit%22+site:yahoo.com&hl=en-US&gl=US&ceid=US:en", source: "Yahoo Finance", sector: "Macro", paywall: false },
  { url: "https://news.google.com/rss/search?q=%22private+equity%22+OR+%22hedge+fund%22+site:cnbc.com&hl=en-US&gl=US&ceid=US:en", source: "CNBC", sector: "Macro", paywall: false },
  { url: "https://news.google.com/rss/search?q=site:reuters.com+(%22private+equity%22+OR+%22private+credit%22+OR+%22hedge+fund%22)&hl=en-US&gl=US&ceid=US:en", source: "Reuters", sector: "Macro", paywall: false },

  // â”€â”€ Premium / Closed Sources (Get slight penalty, but are kept for breaking major news) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { url: "https://news.google.com/rss/search?q=site:bloomberg.com+(%22private+equity%22+OR+%22private+credit%22)&hl=en-US&gl=US&ceid=US:en", source: "Bloomberg", sector: "PE", paywall: true },
  { url: "https://news.google.com/rss/search?q=pitchbook+%22private+equity%22+OR+%22private+credit%22&hl=en-US&gl=US&ceid=US:en", source: "PitchBook News", sector: "PE", paywall: true },
  { url: "https://feeds.content.dowjones.io/public/rss/RSSMarketsMain", source: "WSJ Markets", sector: "Macro", paywall: true },
  { url: "https://www.ft.com/stream/ab70c42c-4d60-4851-89bb-16e2daeddfc1?format=rss", source: "Financial Times", sector: "PE", paywall: true },
  { url: "https://www.privateequitywire.co.uk/feed/",                source: "PE Wire",         sector: "PE",    paywall: true  },
  { url: "https://www.infrastructureinvestor.com/feed/",             source: "Infra Investor",  sector: "Infra", paywall: true  },
  { url: "https://www.perenews.com/feed/",                           source: "PERE News",       sector: "RE",    paywall: true  },
];

const RSS2JSON = "https://api.rss2json.com/v1/api.json?rss_url=";

const MAX_DAYS = 30;
const AI_ENABLED = true; 
const API_BASE = ""; 

function isWithinTimeWindow(pubDate) {
  if (!pubDate) return false;
  const t = new Date(pubDate).getTime();
  if (!isFinite(t)) return false;
  const diff = Date.now() - t;
  return diff <= MAX_DAYS * 24 * 60 * 60 * 1000;
}

const SECTOR_KEYWORDS = {
  PE:     ["private equity","buyout","lbo","kkr","carlyle","blackstone","apollo","eqt","warburg","advent","bain capital", "venture capital", "growth equity"],
  Credit: ["private credit","direct lending","credit fund","private debt","leveraged loan","ares","blue owl","golub"],
  Infra:  ["infrastructure","infrastructure investor","infra fund","infrastructure fund","renewable","renewables","energy transition","solar","wind","battery","storage","grid","transmission","utility","utilities","digital infrastructure","data center","datacenter","fiber","fibre","tower","towers","airport","ports","port","toll road","rail","railway","pipeline","lng","terminal","brookfield","macquarie","ifm","global infrastructure partners","gip","kkr infrastructure","stonepeak"],
  RE:     ["real estate","property","reit","repe","real estate private equity","commercial property","commercial real estate","cre","office","offices","logistics","warehouse","industrial","multifamily","residential","housing","student housing","senior housing","build-to-rent","btr","hotel","hospitality","self storage","self-storage","storage reit","data center real estate","life sciences real estate","blackstone real estate","brookfield real estate","kkr real estate"],
  Hedge:  ["hedge fund","long/short","multi-strategy","macro fund","bridgewater","citadel","millennium"],
  Macro:  ["interest rate","federal reserve","fed","inflation","gdp","central bank","ecb","monetary","pension","sovereign wealth"],
};

function guessSector(title, body, defaultSector) {
  const t = ((title||'') + ' ' + (body||'')).toLowerCase();
  if (/(private credit|direct lending|private debt|unitranche|mezzanine|leveraged loan|bdc|distressed debt)/i.test(t)) return 'Credit';
  if (/\bcredit\b.*(spread|fund|facility|lending|loan)/i.test(t)) return 'Credit';
  if (/(infrastructure|infra fund|digital infra|data cent(er|re)|renewable(s)?|energy transition|clean energy|solar farm|wind farm|offshore wind|battery storage|power grid|toll road|airport|seaport|pipeline|lng terminal|fiber network|cell tower)/i.test(t)) return 'Infra';
  if (/(stonepeak|macquarie infra|brookfield infra|\bgip\b|ifm investors)/i.test(t)) return 'Infra';
  if (/(real estate|commercial property|\brepe\b|multifamily|residential property|office (building|market|space)|logistics park|warehouse|build.to.rent|student housing|senior housing|self.storage|cap rate|\bnoi\b|vacancy rate|rent growth)/i.test(t)) return 'RE';
  if (/\breit\b/i.test(t)) return 'RE';
  if (/(prologis|hines|cbre|jll|cushman|mingtiandi)/i.test(t)) return 'RE';
  if (/(hedge fund|long.short|multi.strategy|global macro|quant fund|managed futures|activist investor|short seller|event.driven)/i.test(t)) return 'Hedge';
  return defaultSector;
}

const TIER1 = ['PitchBook', 'Bloomberg', 'Financial Times', 'WSJ Markets', 'Reuters', 'PE Wire', 'Yahoo Finance', 'CNBC'];
const TIER2 = ['TechCrunch VC', 'The Real Deal', 'AltAssets', 'Renewables Now', 'GlobeSt'];

function qualityScore(a) {
  const title = (a.title || '').toLowerCase();
  const body = (a.body || '').toLowerCase();
  const fullText = title + " " + body;
  
  let score = 25; 

  if (TIER1.some(x => a.source.includes(x))) score += 15;
  else if (TIER2.some(x => a.source.includes(x))) score += 10;

  if (a.paywall === false) {
    score += 15; 
  } else {
    score -= 5;  
  }

  const fundEventKeywords = ["fundraise", "fundraising", "raised", "raising", "closes", "closed", "first close", "final close", "hard cap", "target", "launches fund", "new fund", "vintage", "gp-led", "dry powder", "lp", "limited partner", "commitment"];
  if (fundEventKeywords.some(kw => fullText.includes(kw))) score += 20; 
  if (fundEventKeywords.some(kw => title.includes(kw))) score += 10;

  const macroTechKeywords = [
    "software", "saas", "tech valuation", "artificial intelligence", "ai startup", "openai", "anthropic",
    "interest rate", "fed", "federal reserve", "rate cut", "inflation", 
    "downturn", "distressed", "layoffs", "restructuring", "bankruptcy", 
    "sec", "regulation", "antitrust", "doj"
  ];
  if (macroTechKeywords.some(kw => fullText.includes(kw))) score += 30;
  if (macroTechKeywords.some(kw => title.includes(kw))) score += 15;

  const consumerKeywords = ["watchmaker", "dolls", "toy", "lifestyle", "luxury brand", "retailer", "hasbro", "mattel", "movie", "celebrity"];
  if (consumerKeywords.some(kw => fullText.includes(kw))) score -= 40;

  return Math.max(0, Math.min(100, score));
}

function estimateRelevance(title, body) {
  const text = (title + " " + body).toLowerCase();
  const allKw = Object.values(SECTOR_KEYWORDS).flat();
  return Math.min(55 + allKw.filter(kw => text.includes(kw)).length * 6, 98);
}

let currentFilter = 'all';
let briefingText = '';
let articles = [];
let nextId = 1;

let AUTO_REFRESH_MS = 4 * 60 * 1000;
let autoTimer = null;

function startAutoRefresh() {
  stopAutoRefresh();
  autoTimer = setInterval(() => loadArticles(currentFilter), AUTO_REFRESH_MS);
}

function stopAutoRefresh() {
  if (autoTimer) clearInterval(autoTimer);
  autoTimer = null;
}

document.addEventListener('visibilitychange', () => {
  if (document.hidden) stopAutoRefresh();
  else startAutoRefresh();
});

document.addEventListener('DOMContentLoaded', async () => {
  const d = new Date();
  document.getElementById('current-date').textContent =
    d.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  document.getElementById('email-subject-preview').textContent =
    `ALTÂ·Intel Morning Briefing â€” ${d.toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric', year:'numeric' })}`;

  await loadArticles();
  startAutoRefresh();
});

async function fetchFeed(feed) {
  const enc = encodeURIComponent(feed.url);
  const cacheBuster = `&cb=${Math.random()}`;

  const mapItems = (items, urlField) => items.map(item => {
    const title = item.title || '';
    const body = (item.description || item.content || '').replace(/<[^>]+>/g, '').substring(0, 300);
    const sec = guessSector(title, body, feed.sector);
    
    let articleObj = {
      id: nextId++,
      title: title,
      body: body,
      url: item[urlField] || item.link || '',
      source: feed.source,
      sector: sec,
      rel: estimateRelevance(title, body),
      time: timeAgo(item.pubDate || item.updated || ''),
      _pubDate: item.pubDate || item.updated || null,
      _ts: new Date(item.pubDate || item.updated || 0).getTime() || 0,
      paywall: feed.paywall || false,
      aiSummary: null,
      qscore: 0 
    };
    
    articleObj.qscore = qualityScore(articleObj);
    return articleObj;
  });

  try {
    const res = await fetch(`https://api.allorigins.win/get?url=${enc}${encodeURIComponent(cacheBuster)}`);
    const data = await res.json();
    const xml = data.contents;
    const doc = new DOMParser().parseFromString(xml, 'text/xml');
    const els = Array.from(doc.querySelectorAll('item, entry'));
    if (els.length) {
      const items = els.map(el => ({
        title: el.querySelector('title')?.textContent?.trim() || '',
        link: el.querySelector('link')?.getAttribute('href') || el.querySelector('link')?.textContent?.trim() || '',
        description: (el.querySelector('description')?.textContent || el.querySelector('summary')?.textContent || '').trim(),
        pubDate: (el.querySelector('pubDate')?.textContent || el.querySelector('updated')?.textContent || '').trim(),
      }));
      return mapItems(items, 'link');
    }
  } catch(e) { }

  try {
    const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${enc}${cacheBuster}`);
    const data = await res.json();
    if (data.status === 'ok' && data.items?.length) {
      return mapItems(data.items, 'link');
    }
  } catch(e) { }

  return [];
}

async function loadArticles(sector = null) {
  document.getElementById('feed-container').innerHTML = 
    `<div style="padding:40px 0;text-align:center;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--ink-dim)">Loading live feeds...</div>`;

  nextId = 1;

  try {
    const results = await Promise.all(RSS_FEEDS.map(fetchFeed));
    let all = results.flat();

    const seen = new Set();
    all = all.filter(a => {
      const k = (a.url || '').split('?')[0];
      if (!k || seen.has(k)) return false;
      seen.add(k);
      return true;
    });

    if (all.length > 0) {
      articles = all;
      localStorage.setItem('alt_intel_cache', JSON.stringify(all));
    } else {
      const cachedData = localStorage.getItem('alt_intel_cache');
      if (cachedData) articles = JSON.parse(cachedData);
      else articles = getDemoArticles();
    }
  } catch (error) {
    articles = getDemoArticles();
  }

  articles.sort((a, b) => (b._ts || 0) - (a._ts || 0));

  currentFilter = sector || 'all';
  
  updateTicker();
  renderHero();
  renderFeed();
  renderSidebar();
}

function updateTicker() {
  const tickerInner = document.getElementById('ticker-inner');
  if(!articles || articles.length === 0) return;

  const topForTicker = articles.slice()
                               .sort((a,b) => (b._ts||0) - (a._ts||0))
                               .slice(0, 10);

  const tickerHtml = topForTicker.map(a => 
    `<span class="ticker-item"><strong>${a.source.toUpperCase()}</strong> ${a.title}</span>`
  ).join('');

  tickerInner.innerHTML = tickerHtml + tickerHtml;
}

function timeAgo(dateStr) {
  if (!dateStr) return 'recently';
  const diff = Date.now() - new Date(dateStr).getTime();
  const h = Math.floor(diff / 3600000);
  if (h < 1) return 'just now';
  if (h < 24) return `${h}h ago`;
  return `${Math.floor(h/24)}d ago`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HERO - 24 HOURS LIMIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderHero() {
  const now = Date.now();
  const H24 = 24 * 60 * 60 * 1000;

  // ×¡×™× ×•×Ÿ ×œ×›×ª×‘×•×ª ×ž×”-24 ×©×¢×•×ª ×”××—×¨×•× ×•×ª ×‘×œ×‘×“
  let recentArticles = articles.filter(a => a._ts && (now - a._ts) <= H24);

  // ×”×’× ×ª UI: ×× ××™×Ÿ ×©×•× ×›×ª×‘×” ×ž×”×™×ž×ž×” ×”××—×¨×•× ×”, × ×™×§×— ×ž×›×œ ×”×ž××’×¨ ×›×“×™ ×œ× ×œ×©×‘×•×¨ ××ª ×”×¢×™×¦×•×‘ (×¨×§ ×œ×ž×§×¨×” ×§×™×¦×•×Ÿ)
  if (recentArticles.length === 0) {
    recentArticles = articles;
  }

  // ×ž×™×•×Ÿ ×œ×¤×™ ×”×¦×™×•×Ÿ ×•×œ×§×™×—×ª ×”-3 ×”×˜×•×‘×•×ª ×‘×™×•×ª×¨ (×ž×ª×•×š ××œ×• ×©×¢×‘×¨×• ××ª ×¡×™× ×•×Ÿ ×”×–×ž×Ÿ)
  const top3 = recentArticles.slice()
                             .sort((a,b) => (b.qscore||0) - (a.qscore||0))
                             .slice(0,3);

  const colors = { PE:'var(--pe-c)', Credit:'var(--credit-c)', Infra:'var(--infra-c)', RE:'var(--re-c)', Hedge:'var(--hedge-c)', Macro:'var(--macro-c)' };

  document.getElementById('hero-strip').innerHTML = top3.map(a => `
    <a class="hero-story" href="${a.url || '#'}" target="_blank" style="cursor:pointer; text-decoration:none; color:inherit; display:block;">
      <div class="hero-kicker" style="color:${colors[a.sector] || 'var(--ink-mid)'}">
        ${a.sector} Â· ${a.source}
        <span style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--ink-dim);margin-left:8px;">${a.time}</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:8px;background:${colors[a.sector]||'var(--ink-dim)'};color:#fff;padding:1px 5px;margin-left:4px;opacity:0.85;">Score: ${a.qscore||0}</span>
      </div>
      <div class="hero-headline">${a.title}</div>
      <div class="hero-deck">${(a.body||'').substring(0,130)}â€¦</div>
    </a>
  `).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FEED
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function whyItMatters(a) {
  const t = ((a.title||'') + ' ' + (a.body||'')).toLowerCase();
  
  if (/(software|saas|tech valuation|downturn)/i.test(t)) return 'Tech Sector Impact â€” affects private equity portfolios heavily weighted towards SaaS and software buyouts.';
  if (/(ai|artificial intelligence|openai|anthropic)/i.test(t)) return 'AI Disruption â€” requires GPs to evaluate structural impacts on existing portfolios and opens new infra/VC opportunities.';
  if (/(interest rate|fed|inflation|rate cut)/i.test(t)) return 'Macro Headwind/Tailwind â€” directly influences cost of debt, valuations, and exit environments across all private markets.';

  if (/(first close|final close|fundraise|raised|hard cap|close on)/i.test(t)) return 'LP allocation signal â€” indicates appetite for this strategy and vintage.';
  if (/(lbo|take.private|acqui|buyout|merger)/i.test(t)) return 'Deal activity â€” relevant for comparable valuations and sector momentum.';
  if (/(secondar|gp.led|continuation|gp stake)/i.test(t)) return 'Liquidity signal â€” reflects GP sentiment and portfolio valuations.';
  if (/(nav loan|direct lending|private credit|unitranche)/i.test(t)) return 'Credit market signal â€” impacts cost of capital and deal structuring.';
  if (a.sector === 'Infra') return 'Infrastructure deployment signal â€” energy transition and digital infra remain LP priorities.';
  if (a.sector === 'RE') return 'Real estate repricing â€” cap rate movements affect RE fund NAVs and exit timing.';
  if (a.sector === 'Credit') return 'Credit dynamics â€” directly affects direct lending returns and deal flow.';
  if (a.sector === 'Hedge') return 'Hedge fund positioning â€” relevant for liquid alts allocators.';
  return 'Private markets intelligence â€” relevant for LP allocators and fund managers.';
}

function renderFeed() {
  const list = currentFilter === 'all' ? articles : articles.filter(a => a.sector === currentFilter);
  document.getElementById('feed-count').textContent = `â€” ${list.length} articles`;

  document.getElementById('feed-container').innerHTML = list.map((a, i) => {
    const rel = a.rel || 75;
    const dots = Array(5).fill(0).map((_,d) => `<span class="rel-dot ${d < Math.round(rel/20) ? 'filled' : ''}"></span>`).join('');
    const articleUrl = a.url || a.link || '#';
    
    return `
    <a class="article" style="animation-delay:${i * 0.04}s; text-decoration:none; color:inherit; display:grid; grid-template-columns:1fr auto; gap:16px;" href="${articleUrl}" target="_blank">
      <div class="article-left">
        <div class="article-kicker">
          <span class="sector-pill ${a.sector}">${a.sector}</span>
          <span class="article-source">${a.source}</span>
          <span class="article-time">${a.time}</span>
        </div>
        <div class="article-headline">${a.title}</div>
        <div class="article-body">${a.body || ''}</div>
        <div class="article-why"><span class="why-label">Why it matters</span>${whyItMatters(a)}</div>
        ${a.aiSummary ? `
        <div class="ai-summary-wrap">
          <div class="ai-label">âœ¦ AI Analysis</div>
          <div class="ai-text">${a.aiSummary}</div>
        </div>
        ` : ''}
        <div class="article-actions">
          ${a.paywall
            ? '<span class="read-more">ðŸ”’ Read Article â†’</span>'
            : '<span class="read-more">Read Free â†’</span>'
          }
          <div class="rel-score"><div class="rel-dots">${dots}</div>Score: ${a.qscore}</div>
          <button class="action-btn ${a.aiSummary ? 'summarized' : ''}"
            onclick="event.preventDefault(); event.stopPropagation(); summarize(${a.id}, this);"
            ${a.aiSummary ? 'disabled' : ''}>
            ${a.aiSummary ? 'âœ“ Analyzed' : 'âš¡ AI Analyze'}
          </button>
        </div>
      </div>
      <div class="article-right">
        <span class="big-number">${String(i+1).padStart(2,'0')}</span>
      </div>
    </a>
  `}).join('');
}

function filter(sector, btn) {
  currentFilter = sector;
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderFeed();
  renderSidebar();
}

async function loadFeed() {
  const ico = document.getElementById('refresh-ico');
  ico.classList.add('spin');
  await loadArticles();
  ico.classList.remove('spin');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SIDEBAR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSidebar() {
  const sectors = ['PE','Credit','Infra','RE','Hedge','Macro'];
  const c = { PE:'var(--pe-c)', Credit:'var(--credit-c)', Infra:'var(--infra-c)', RE:'var(--re-c)', Hedge:'var(--hedge-c)', Macro:'var(--macro-c)' };
  const counts = {};
  sectors.forEach(s => counts[s] = articles.filter(a => a.sector === s).length);
  const max = Math.max(...Object.values(counts), 1);
  document.getElementById('total-articles').textContent = articles.length;

  document.getElementById('sector-stats').innerHTML = sectors.map(s => `
    <div class="sector-stat">
      <span class="stat-name" style="color:${c[s]}">${s}</span>
      <div class="stat-bar"><div class="stat-fill" style="width:${counts[s]/max*100}%; background:${c[s]}"></div></div>
      <span class="stat-n">${counts[s]}</span>
    </div>
  `).join('');

  const sourceCounts = {};
  articles.forEach(a => { sourceCounts[a.source] = (sourceCounts[a.source] || 0) + 1; });
  const sources = Object.entries(sourceCounts).sort((x,y) => y[1]-x[1]).slice(0,8);

  const FALLBACK_SOURCES = [];

  document.getElementById('sources-widget').innerHTML = (sources.length ? sources : FALLBACK_SOURCES.map(s => [s.name, s.count])).map(([name, count]) => `
    <div class="source-row">
      <span class="source-n">${count}</span>
      <span class="source-label">${name}</span>
      <span class="source-status-dot ${count > 0 ? 'on' : 'off'}"></span>
    </div>
  `).join('');
}

async function summarize(id, btn) {
  try {
    if (!AI_ENABLED) { alert('AI is disabled. Configure the proxy and set AI_ENABLED=true.'); return; }
    const a = articles.find(x => x.id === id);
    if (!a) return;
    if (btn) btn.disabled = true;

    const res = await fetch((API_BASE ? `${API_BASE}/api/summarize` : `/api/summarize`), {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        title: a.title,
        url: a.url,
        source: a.source,
        sector: a.sector,
        excerpt: a.body || ''
      })
    });

    if (!res.ok) throw new Error(`Summarize failed: ${res.status}`);
    const data = await res.json();
    a.aiSummary = data.summary || '';
    renderFeed();
  } catch (e) {
    alert('AI Analyze failed. Check proxy is running and API key is set.');
  } finally {
    if (btn) btn.disabled = false;
  }
}

async function generateBriefing() {
  try {
    const btn = document.getElementById('gen-btn');
    if (btn) btn.disabled = true;

    const items = articles.slice(0, 30).map(a => ({
      title: a.title, url: a.url, source: a.source, sector: a.sector, time: a.time
    }));

    const res = await fetch((API_BASE ? `${API_BASE}/api/briefing` : `/api/briefing`), {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ items })
    });

    if (!res.ok) throw new Error(`Briefing failed: ${res.status}`);
    const data = await res.json();
    const out = document.getElementById('briefing-output');
    if (out) out.textContent = data.briefing || '';
  } catch (e) {
    alert('Briefing failed. Check proxy is running and API key is set.');
  } finally {
    const btn = document.getElementById('gen-btn');
    if (btn) btn.disabled = false;
  }
}

function openEmailModal() { document.getElementById('email-modal').classList.add('open'); }
function closeEmailModal() { document.getElementById('email-modal').classList.remove('open'); document.getElementById('success-msg').classList.remove('show'); }
function closeModalOutside(e) { if (e.target === document.getElementById('email-modal')) closeEmailModal(); }

async function subscribe() {
  const email = document.getElementById('email-input').value.trim();
  if (!email || !email.includes('@')) {
    document.getElementById('email-input').style.borderColor = 'var(--accent)';
    return;
  }
  const btn = document.getElementById('subscribe-btn');
  btn.disabled = true; btn.textContent = '...';

  try {
    const res = await fetch(`${API_BASE}/subscribe`, {
      method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email }),
    });
    const data = await res.json();
    if (data.ok) {
      document.getElementById('email-preview-section').style.display = 'none';
      document.getElementById('success-msg').classList.add('show');
    } else {
      btn.disabled = false; btn.textContent = 'Subscribe';
    }
  } catch(e) {
    document.getElementById('email-preview-section').style.display = 'none';
    document.getElementById('success-msg').classList.add('show');
  }
}

function getDemoArticles() {
  return [
    { id:1, sector:"Macro", source:"Reuters", title:"Fed Signals Further Rate Caution Following Persistent Inflation Data", body:"Federal Reserve officials signaled they are in no rush to cut interest rates, creating a challenging environment for software buyouts and highly leveraged Private Equity portfolios that rely on cheap debt.", time:"1h ago", rel:95, aiSummary:null, qscore: 95, url:"#", _ts: Date.now() - 3600000 },
    { id:2, sector:"PE", source:"PitchBook (Open)", title:"Thoma Bravo Eyes Software Market Downturn Dubbed the SaaSpocalypse", body:"Tech-focused buyout firm Thoma Bravo is looking to capitalise on the ongoing software market downturn, as a disconnect between high-quality firms and riskier software providers creates selective entry points.", time:"3h ago", rel:91, aiSummary:null, qscore: 90, url:"#", _ts: Date.now() - 10800000 },
    { id:3, sector:"Hedge", source:"CNBC", title:"Blackstone Expands Anthropic Stake to Around $1bn amid AI Boom", body:"Blackstone has expanded its investment in AI startup Anthropic, bringing its total stake to around $1bn at the current valuation, signalling continued institutional appetite for AI infrastructure exposure.", time:"5h ago", rel:88, aiSummary:null, qscore: 85, url:"#", _ts: Date.now() - 18000000 }
  ];
}
</script>
</body>
</html>
